{"version":3,"file":"parser-internals.js","sourceRoot":"","sources":["../src/parser-internals.ts"],"names":[],"mappings":"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","sourcesContent":["import { Schema } from \"./schema\";\n\nconst MAX_RANGE = 0x1FFFFFFF ;\n\n// \"Only repeated fields of primitive numeric types (types which use the varint, 32-bit, or 64-bit wire types) can be declared \"packed\".\"\nexport const PACKABLE_TYPES = Object.freeze([\n\t// varint wire types\n\t'int32', 'int64', 'uint32', 'uint64', 'sint32', 'sint64', 'bool',\n\t// + ENUMS\n\t// 64-bit wire types\n\t'fixed64', 'sfixed64', 'double',\n\t// 32-bit wire types\n\t'fixed32', 'sfixed32', 'float'\n])\nexport type NameMappedValueMap = Map<string, string>;\nconst parseBool = <T extends Options>(m: T, s: string) => {\n\tif (m.options.has(s)) switch (m.options.get(s)) {\n\t\tcase \"true\": return true;\n\t\tcase \"false\": return false;\n\t\tdefault: throw new SyntaxError(`Cannot convert value of ${s} (${m.options.get(s)}) to boolean`)\n\t}\n\treturn false;\n}\nconst optionsWeakMap = new WeakMap<Options, NameMappedValueMap>();\nexport class Options {\n\tget options(): NameMappedValueMap {\n\t\tlet m = optionsWeakMap.get(this);\n\t\tif (!m) {\n\t\t\tm = new Map<string, string>();\n\t\t\toptionsWeakMap.set(this, m);\n\t\t}\n\t\treturn m\n\t}\n}\nexport class MessageField extends Options {\n\tname = '';\n\ttype = '';\n\ttag = -1;\n\tmap: null | {from: string; to: string} = null;\n\toneof = '';\n\trequired = false;\n\trepeated = false;\n\tdeprecated = false;\n\tpacked = false;\n\toptional = false;\n}\ninterface MessageFields {fields: MessageField[]}\nfunction onField<T extends MessageFields>({fields}: T, c: TokenCount) {\n\tconst field: MessageField = new MessageField;\n\twhile (!c.done) switch (c.peek()) {\n\t\tcase '=':\n\t\t\tfield.tag = Number(c.next(2));\n\t\t\tbreak\n\n\t\tcase 'map':\n\t\t\tif (c.peek(1) !== '<')\n\t\t\t\tthrow new SyntaxError(`Unexpected token in map type: ${c.peek(1)}`)\n\t\t\tif (c.peek(3) !== ',')\n\t\t\t\tthrow new SyntaxError(`Unexpected token in map type: ${c.peek(3)}`)\n\t\t\tif (c.peek(5) !== '>')\n\t\t\t\tthrow new SyntaxError(`Unexpected token in map type: ${c.peek(5)}`)\n\n\t\t\tfield.type = 'map';\n\t\t\tfield.map = {\n\t\t\t\tfrom: c.next(3),\n\t\t\t\tto: c.next(2)\n\t\t\t};\n\t\t\tfield.name = c.next(2);\n\t\t\tbreak;\n\n\t\tcase 'repeated':\n\t\tcase 'required':\n\t\tcase 'optional':\n\t\t\t{\n\t\t\t\tlet t = c.next();\n\t\t\t\tfield.required = t === 'required'\n\t\t\t\tfield.repeated = t === 'repeated'\n\t\t\t\tfield.type = c.next()\n\t\t\t\tfield.name = c.next()\n\t\t\t}\n\t\t\tbreak\n\n\t\tcase '[':\n\t\t\tonFieldOptions(field, c);\n\t\t\tfield.packed = parseBool(field, \"packed\")\n\t\t\tfield.deprecated = parseBool(field, \"deprecated\")\n\t\t\tbreak;\n\n\t\tcase ';':\n\t\t\tif (field.name === '')\n\t\t\t\tthrow new SyntaxError('Missing field name');\n\t\t\tif (field.type === '')\n\t\t\t\tthrow new SyntaxError(`Missing type in message field: ${field.name}`)\n\t\t\tif (field.tag === -1)\n\t\t\t\tthrow new SyntaxError(`Missing tag number in message field: ${field.name}`)\n\t\t\tfields.push(field)\n\t\t\tc.t++\n\t\t\treturn field;\n\n\t\tdefault:\n\t\t\tfield.type = c.next()\n\t\t\tfield.name = c.next()\n\t\t\tbreak\n\t}\n\n\tthrow new Error('No ; found for message field')\n}\nfunction onFieldOptions<T extends Options>({options}: T, c: TokenCount) {\n\twhile (!c.done) switch (c.peek()) {\n\t\tcase '[':\n\t\tcase ',': {\n\t\t\tlet name = c.next(2);\n\t\t\tif (name === ')') {\n\t\t\t\tname = c.next();\n\t\t\t\tc.t++\n\t\t\t}\n\t\t\tif (c.next() !== '=')\n\t\t\t\tthrow new SyntaxError(`Unexpected token in field options in ${name}`);\n\t\t\tif (c.peek() === ']')\n\t\t\t\tthrow new SyntaxError(`Unexpected ] in field option in ${name}`);\n\t\t\tlet value = c.next();\n\t\t\toptions.set(name, value);\n\t\t}\n\t\tbreak\n\t\tcase ']':\n\t\t\tc.t++\n\t\t\treturn;\n\t\tdefault:\n\t\t\tthrow new SyntaxError(`Unexpected token in field options: ${c.peek()}`);\n\t}\n\n\tthrow new SyntaxError('No closing tag for field options');\n}\n\n\nexport function onPackageName(schema: Schema, t: TokenCount) {\n\tschema.package = t.next(2);\n\tif (t.next() !== ';')\n\t\tthrow new SyntaxError(`No ; found after package name ${schema.package}`);\n}\n\nexport function onSyntaxVersion(schema: Schema, n: TokenCount) {\n\tif (n.peek(1) !== '=')\n\t\tthrow new SyntaxError(`Syntax version missing assignment`);\n\tswitch (n.next(3)) {\n\t\tcase '\"proto2\"': n.t++; schema.syntax = 2; return 2;\n\t\tcase '\"proto3\"': n.t++; schema.syntax = 3; return 3;\n\t}\n\tthrow new SyntaxError(`${n.peek(-2)} is not a valid protobuf syntax version`)\n}\n\nexport function onOption<T extends Options>({options}: T, n: TokenCount) {\n\tlet name = '', value = '', paren = false;\n\twhile (!n.done) switch (n.next()) {\n\t\tcase ';':\n\t\t\tif (options.has(name))\n\t\t\t\tthrow new SyntaxError(`Duplicate option named ${name} on same options value`)\n\t\t\toptions.set(name, value)\n\t\t\treturn;\n\n\t\tcase 'option':\n\t\t\tparen = n.peek() === '('\n\t\t\tname = n.next(+paren + 1);\n\t\t\tif (paren && n.next() !== ')') throw new SyntaxError(`Parenthesised options must be closed (name: ${name})`)\n\t\t\tif (n.peek()[0] === '.') name += n.next()\n\t\t\tbreak;\n\n\t\tcase '=':\n\t\t\tif (name === '') throw new SyntaxError(`Name must be provided for option with value ${n.peek()}`)\n\t\t\tvalue = n.next()\n\t\t\tif (name === 'optimize_for') switch (value) {\n\t\t\t\tdefault: throw new SyntaxError(`Unexpected value for option optimize_for: ${value}`)\n\t\t\t\tcase 'SPEED': case 'CODE_SIZE': case 'LITE_RUNTIME':\n\t\t\t} else if (value === '{') throw new Error('Map options are currently unimplemented.')\n\t\t\tbreak\n\t}\n}\nexport class EnumValue extends Options {\n\tconstructor(public name: string, public value: number) {super()}\n}\nexport class Enum extends Options {\n\tvalues: EnumValue[] = []\n\tconstructor(public name: string) {super()}\n}\nfunction onEnumValue(e: Enum, n: TokenCount) {\n\twhile (!n.done) switch (n.peek()) {\n\t\tcase 'reserved': break;\n\t\tdefault: {\n\t\t\tlet name = n.next()\n\t\t\tif (n.next() !== '=')\n\t\t\t\tthrow new SyntaxError(`enum value missing setter value`)\n\t\t\tlet value = +n.next();\n\t\t\tlet ret = new EnumValue(name, value);\n\t\t\tif (n.peek() === '[') onFieldOptions(ret, n);\n\t\t\tif (n.next() !== ';')\n\t\t\t\tthrow new SyntaxError(`enum value missing semicolon`);\n\n\t\t\te.values.push(ret)\n\t\t\treturn ret\n\t\t}\n\t}\n\tthrow new SyntaxError(`enum value was not closed before token completion`)\n}\nexport interface Enums {enums: Enum[]};\nexport function onEnum<T extends Enums>({enums}: T, n: TokenCount) {\n\tconst tenum: Enum = new Enum(n.next(2))\n\tn.next()\n\twhile (!n.done) switch (n.peek()) {\n\t\tcase 'option':\n\t\t\tonOption(tenum, n);\n\t\t\tbreak;\n\t\tcase '}':\n\t\t\tn.next(n.peek(0) === ';' ? 2 : 1)\n\t\t\tenums.push(tenum)\n\t\t\treturn;\n\t\tdefault:\n\t\t\tonEnumValue(tenum, n)\n\t}\n}\n\nexport class Message extends Options {\n\tenums: Enum[] = [];\n\textends: Extends[] = [];\n\tmessages: Message[] = [];\n\tfields: MessageField[] = [];\n\textensions: null | {from: number; to: number;} = null;\n\tconstructor(public name: string) {super()}\n}\nexport interface Messages {messages: Message[]}\nexport function onMessage<T extends Messages>({messages}: T, c: TokenCount) {\n\tconst m = new Message(c.next(2))\n\tlet lvl = 0\n\twhile (!c.done) switch (c.peek()) {\n\t\tcase '{': ++lvl; ++c.t; break;\n\t\tcase '}':\n\t\t\t++c.t;\n\t\t\tif (!--lvl) {\n\t\t\t\tmessages.push(m);\n\t\t\t\treturn m\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'map': case 'required': case 'optional': case 'repeated':\n\t\t\tonField(m, c); break;\n\t\tcase 'enum': onEnum(m,c); break;\n\t\tcase 'message': onMessage(m, c); break;\n\t\tcase 'extensions': onExtensions(m, c); break;\n\t\tcase 'oneof': {\n\t\t\tlet name = c.next(2);\n\t\t\tif (c.next() !== '{')\n\t\t\t\tthrow new SyntaxError(`Unexpected oneof token: ${c.peek(-1)}; should be {`);\n\n\t\t\twhile (c.peek() !== '}') {\n\t\t\t\tconst field = onField(m, c);\n\t\t\t\tfield.oneof = name;\n\t\t\t\tfield.optional = true;\n\t\t\t}\n\t\t\tc.t++;\n\t\t}\n\t\tbreak\n\t\tcase 'extend': onExtend(m, c); break;\n\t\tcase ';': c.t++; break;\n\t\tcase 'reserved': case 'option':\n\t\t\tdo ++c.t;\n\t\t\twhile (c.peek() !== ';');\n\t\t\tbreak;\n\n\t\tdefault: onField(m, c).optional = true; break;\n\t}\n\tthrow new SyntaxError(`message was not closed before token completion`)\n}\nfunction onExtensions(m: Message, c: TokenCount) {\n\tconst from = +c.next(2)\n\tif (isNaN(from))\n\t\tthrow new SyntaxError(`Invalid \"from\" value in extensions definition`)\n\n\tif (c.next() !== 'to') throw new Error(\"Expected keyword 'to' in extensions definition\")\n\tlet sto = c.next()\n\tconst to = sto === 'max' ? MAX_RANGE : +sto\n\tif (isNaN(to))\n\t\tthrow new SyntaxError(`Invalid \"to\" value in extensions definition`)\n\n\n\tif (c.next() !== ';')\n\t\tthrow new SyntaxError('Missing ; in extensions definition')\n\tm.extensions = {from, to}\n}\nexport class Extends {\n\tmessages: Message[] = []\n\tconstructor(public name: string) {}\n}\ninterface Extendss {extends: Extends[]}\nexport function onExtend<T extends Extendss>({extends: extendss}: T, c: TokenCount) {\n\tlet e = new Extends(c.peek(2))\n\tonMessage(e, c)\n\textendss.push(e)\n}\nexport function onImport({imports}: Schema, c: TokenCount) {\n\tlet file = c.next(2).replace(/^(?:\"([^\"]+)\"|'([^']+)')$/, '$1$2')\n\tif (c.next() !== ';')\n\t\tthrow new SyntaxError(`Expected \";\" after import filename.`)\n\n\timports.push(file)\n}\nexport class RPC extends Options {\n\tconstructor(public name: string) {super()}\n\tinput_type = ''\n\toutput_type = ''\n\tclient_streaming = false\n\tserver_streaming = false\n}\nexport class Service extends Options {\n\tconstructor(public name: string) {super()}\n\tmethods: RPC[] = []\n}\nexport function onService({services}: Schema, c: TokenCount) {\n\tconst serv = new Service(c.next(2))\n\tif (c.next() !== '{')\n\t\tthrow new SyntaxError(`Unexpected service token: ${c.peek(-1)}`)\n\n\twhile (!c.done) switch (c.peek()) {\n\t\tcase '}':\n\t\t\tc.next();\n\t\t\tif (c.peek() === ';') c.t++;\n\t\t\tservices.push(serv);\n\t\t\treturn;\n\n\t\tcase 'option':\n\t\t\tonOption(serv, c);\n\t\t\tbreak;\n\n\t\tcase 'rpc':\n\t\t\tonRPC(serv, c);\n\t\t\tbreak;\n\t}\n}\nfunction onRPC({methods}: Service, c: TokenCount) {\n\tconst e = (...chars: string[]) => {\n\t\tfor (const char of chars) if (char !== c.next()) throw new SyntaxError(`Unexpected RPC token: ${c.peek(-1)}; expected \"${char}\"`)\n\t}\n\tconst rpc = new RPC(c.next(2))\n\te('(')\n\n\tif (c.peek() === 'stream') {\n\t\trpc.client_streaming = true\n\t\tc.t++\n\t}\n\trpc.input_type = c.next()\n\te(')', 'returns', '(')\n\n\tif (c.peek() === 'stream') {\n\t\trpc.server_streaming = true\n\t\tc.t++\n\t}\n\trpc.output_type = c.next()\n\te(')')\n\tif (c.peek() === '{') while (!c.done) switch (c.next()) {\n\t\tcase '}':\n\t\t\tif (c.peek() === ';') c.t++\n\t\t\tmethods.push(rpc)\n\t\t\treturn rpc\n\n\t\tcase 'option':\n\t\t\tonOption(rpc, c);\n\t\t\tbreak;\n\t} else if (c.peek() === ';') {\n\t\tc.t++;\n\t\tmethods.push(rpc);\n\t\treturn rpc\n\t}\n\tthrow new Error('No closing tag for rpc')\n}\n\nexport class TokenCount {\n\tt = 0\n\tl: number\n\tdone: boolean\n\tconstructor(private tokens: readonly string[]) {\n\t\tthis.l = tokens.length\n\t\tthis.done = this.l === 0\n\t}\n\tpeek(n = 0) {\n\t\treturn this.tokens[this.t + n]\n\t}\n\tnext(n = 1) {\n\t\tif (n < 1) throw new RangeError()\n\t\tthis.done = this.l === (this.t += n);\n\t\treturn this.tokens[this.t - 1];\n\t}\n}\n"]}